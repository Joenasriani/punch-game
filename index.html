<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STRESS BUSTER 3000</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #ffffff;
            color: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            touch-action: none;
        }

        .title-font {
            font-family: 'Anton', 'Impact', 'Arial Black', sans-serif;
            letter-spacing: 0.12em;
        }

        @keyframes highlight-intro {
            0% { transform: scale(1); border-color: #e5e7eb; }
            50% { transform: scale(1.1); border-color: #6366f1; box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); }
            100% { transform: scale(1); border-color: #e5e7eb; }
        }

        .intro-highlight {
            animation: highlight-intro 0.6s ease-out forwards;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        
        .shake-active {
            animation: shake 0.15s cubic-bezier(.36,.07,.19,.97) both;
        }

        #game-wrapper {
            position: relative;
            width: 90vw;
            max-width: 500px;
            margin: 10px auto;
            aspect-ratio: 1/1;
            display: none;
            cursor: none;
        }

        canvas {
            border: 4px solid #e5e7eb;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            width: 100%;
            height: 100%;
            background-color: #f9fafb;
            touch-action: none;
        }

        .fist-cursor {
            position: fixed;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 1000;
            font-size: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));
            transform-origin: center center;
            line-height: 1;
        }

        .punching {
            transform: scale(1.3);
        }

        #library {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            width: 100%;
            padding: 10px 20px;
            margin-bottom: 5px;
            justify-content: flex-start;
            -webkit-overflow-scrolling: touch;
        }

        @media (min-width: 768px) {
            #library { justify-content: center; }
        }

        .thumb-btn {
            flex: 0 0 auto;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #e5e7eb;
            cursor: pointer;
            background: #f9fafb;
        }

        .thumb-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #loading-indicator {
            display: none;
            color: #6366f1;
            font-size: 14px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <div id="shake-container" class="flex flex-col items-center py-6 md:py-12 px-4 min-h-screen w-full">
        <div class="text-center mb-4">
            <div class="text-4xl md:text-6xl font-black mb-2 text-indigo-600 uppercase title-font">STRESS BUSTER 3000</div>
            <p class="text-indigo-400 text-[10px] font-bold uppercase tracking-[0.4em]">release your temper!</p>
        </div>

        <div id="library"></div>

        <div id="loading-indicator">LOADING TARGET...</div>

        <div id="setup-screen" class="w-full max-w-xs mb-4 text-center">
            <label class="flex flex-col items-center justify-center w-full h-14 cursor-pointer rounded-xl border-2 border-dashed border-gray-300 hover:bg-gray-50 transition">
                <p class="text-[11px] text-gray-500 font-semibold uppercase">or Upload Custom Victim</p>
                <input id="image-input" type="file" class="hidden" accept="image/*" />
            </label>
            <p class="text-[9px] text-indigo-300 mt-2 font-medium italic">High-resolution images work best.</p>
        </div>

        <div id="game-wrapper">
            <canvas id="game-canvas"></canvas>
        </div>

        <div id="controls" class="hidden mt-6 flex justify-center gap-3">
            <button id="reset-btn" class="bg-gray-100 text-gray-700 px-6 py-2 rounded-full font-bold text-xs uppercase tracking-wider">Reset</button>
            <button id="save-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-full font-bold text-xs uppercase tracking-wider">Save</button>
        </div>
    </div>

    <div id="custom-cursor" class="fist-cursor hidden">ðŸ‘Š</div>

    <script>
        const imageInput = document.getElementById('image-input');
        const gameWrapper = document.getElementById('game-wrapper');
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d', { willReadFrequently: true });

        const controls = document.getElementById('controls');
        const customCursor = document.getElementById('custom-cursor');
        const saveBtn = document.getElementById('save-btn');
        const resetBtn = document.getElementById('reset-btn');
        const libraryDiv = document.getElementById('library');
        const loadingIndicator = document.getElementById('loading-indicator');
        const shakeContainer = document.getElementById('shake-container');

        const PEOPLE = [
            { name: "TRUMP", url: "/img/trump.jpg" },
            { name: "BEZOS", url: "/img/bezos.jpg" },
            { name: "ELON", url: "/img/elon.jpeg" },
            { name: "ZUCK", url: "/img/zuckerberg.jpg" },
            { name: "GATES", url: "/img/gates.jpg" },
            { name: "COOK", url: "/img/cook.jpg" },
            { name: "ALTMAN", url: "/img/altman.jpg" }
        ];

        let currentImgUrl = PEOPLE[0].url;
        let originalImg = null;
        let particles = [];
        let animationFrame;
        let audioCtx;
        const isTouch = 'ontouchstart' in window;

        function playPunchSFX() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gThump = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);
            gThump.gain.setValueAtTime(0.5, now);
            gThump.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            osc.connect(gThump);
            gThump.connect(audioCtx.destination);
            osc.start();
            osc.stop(now + 0.15);
        }

        class Particle {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.size = Math.random() * 3 + 2;
                this.speedX = (Math.random() - 0.5) * 10;
                this.speedY = (Math.random() - 0.5) * 10 - 2;
                this.gravity = 0.4;
                this.life = 1.0;
                this.decay = 0.04;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                this.speedY += this.gravity; this.life -= this.decay;
            }
            draw() {
                ctx.fillStyle = `rgba(220, 20, 20, ${this.life})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(offCanvas, 0, 0);
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => { p.update(); p.draw(); });
            if (particles.length > 0) animationFrame = requestAnimationFrame(loop);
            else animationFrame = null;
        }

        function populateLibrary() {
            libraryDiv.innerHTML = '';
            PEOPLE.forEach((person, i) => {
                const btn = document.createElement('div');
                btn.className = 'thumb-btn intro-highlight';
                btn.style.animationDelay = `${i * 0.1}s`;
                btn.innerHTML = `<img src="${person.url}" alt="${person.name}">`;
                btn.onclick = () => initGameWithImage(person.url);
                libraryDiv.appendChild(btn);
            });
        }

        function initGameWithImage(imgSrc) {
            loadingIndicator.style.display = 'block';
            gameWrapper.style.display = 'none';
            controls.classList.add('hidden');
            currentImgUrl = imgSrc;

            const img = new Image();
            img.onload = function() {
                originalImg = img;
                loadingIndicator.style.display = 'none';
                const size = Math.min(window.innerWidth * 0.9, 500);
                canvas.width = offCanvas.width = size;
                canvas.height = offCanvas.height = size;
                const scale = Math.max(size / img.width, size / img.height);
                const x = (size - img.width * scale) / 2;
                const y = (size - img.height * scale) / 2;
                offCtx.clearRect(0, 0, size, size);
                offCtx.drawImage(img, x, y, img.width * scale, img.height * scale);
                ctx.drawImage(offCanvas, 0, 0);
                gameWrapper.style.display = 'block';
                controls.classList.remove('hidden');
                if (!isTouch) customCursor.classList.remove('hidden');
            };
            img.src = imgSrc;
        }

        function handlePunch(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            const canvasX = (clientX - rect.left) * (canvas.width / rect.width);
            const canvasY = (clientY - rect.top) * (canvas.height / rect.height);
            if (canvasX < 0 || canvasX > canvas.width || canvasY < 0 || canvasY > canvas.height) return;

            if (isTouch) {
                customCursor.style.left = (clientX - 50) + 'px';
                customCursor.style.top = (clientY - 50) + 'px';
                customCursor.classList.remove('hidden');
                setTimeout(() => customCursor.classList.add('hidden'), 150);
            }

            customCursor.classList.add('punching');
            setTimeout(() => customCursor.classList.remove('punching'), 100);
            
            playPunchSFX();
            applySmudge(canvasX, canvasY);
            for(let i=0; i<15; i++) particles.push(new Particle(canvasX, canvasY));
            if (!animationFrame) loop();
            
            shakeContainer.classList.remove('shake-active');
            void shakeContainer.offsetWidth; 
            shakeContainer.classList.add('shake-active');
        }

        function applySmudge(cx, cy) {
            const radius = isTouch ? 50 : 70;
            const strength = 0.2;
            const startX = Math.max(0, cx - radius), startY = Math.max(0, cy - radius);
            const width = Math.min(canvas.width - startX, radius * 2), height = Math.min(canvas.height - startY, radius * 2);
            const imageData = offCtx.getImageData(startX, startY, width, height);
            const data = imageData.data;
            const copy = new Uint8ClampedArray(data);
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const dx = (startX + x) - cx, dy = (startY + y) - cy;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < radius) {
                        const factor = (1 - dist / radius) * strength;
                        const sx = Math.floor(x - dx * factor), sy = Math.floor(y - dy * factor);
                        if (sx >= 0 && sx < width && sy >= 0 && sy < height) {
                            const si = (sy * width + sx) * 4, di = (y * width + x) * 4;
                            data[di] = copy[si]; data[di+1] = copy[si+1]; data[di+2] = copy[si+2];
                        }
                    }
                }
            }
            offCtx.putImageData(imageData, startX, startY);
            offCtx.fillStyle = 'rgba(0,0,0,0.03)';
            offCtx.beginPath(); offCtx.arc(cx, cy, radius, 0, Math.PI * 2); offCtx.fill();
        }

        window.onload = () => { populateLibrary(); initGameWithImage(currentImgUrl); };
        resetBtn.onclick = () => initGameWithImage(currentImgUrl);
        imageInput.onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => initGameWithImage(ev.target.result);
            reader.readAsDataURL(e.target.files[0]);
        };
        window.onmousemove = (e) => {
            if (isTouch) return;
            customCursor.style.left = (e.clientX - 50) + 'px';
            customCursor.style.top = (e.clientY - 50) + 'px';
        };
        canvas.onpointerdown = (e) => handlePunch(e.clientX, e.clientY);
        saveBtn.onclick = () => {
            const link = document.createElement('a');
            link.download = 'punched.png';
            link.href = offCanvas.toDataURL();
            link.click();
        };
    </script>
</body>
</html>

